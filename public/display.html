<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Display ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏î‡πÄ‡∏ô‡∏ó</title>
<!-- Bootstrap 5 CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<style>
  body { background-color: #f8f9fa; }
  .display-container { max-width: 700px; margin: 50px auto; }
  .donate-item {
    display: flex;
    align-items: start;
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;

    /* animation */
    opacity: 0;
    transform: translateX(100%);
    animation: slideIn 0.5s forwards;
  }
  .avatar { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-right: 10px; }

  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
</head>
<body style="background-color: green;" class="text-light">

<div class="display-container">
  <div class="text-center mb-3">
    
    <h3 class="mt-3">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå <div onclick="unlockTTS()" class="btn btn-light btn-sm" id="sound_control">üîá</div></h3>
  </div>
  <div id="msgList" class="d-flex flex-column-reverse"></div>
</div>

<script>
  let sound_control = false
function unlockTTS() {
    const msg = new SpeechSynthesisUtterance(" ");
    msg.lang = "th-TH";
    speechSynthesis.speak(msg);
    //alert("‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß üé§");
    // toggle state
    sound_control = !sound_control;

    // update UI
    const btn = document.getElementById("sound_control");
    btn.textContent = sound_control ? "üîä" : "üîá";

}

const msgList = document.getElementById("msgList");

// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° WebSocket
const ws = new WebSocket("ws://localhost:8081");

ws.onopen = () => console.log("Connected to WebSocket server");

ws.onmessage = (event) => {
    let data;
    try {
        data = JSON.parse(event.data);
    } catch {
        data = { name: "‡∏ú‡∏π‡πâ‡πÇ‡∏î‡πÄ‡∏ô‡∏ó", avatar: "https://via.placeholder.com/50", message: event.data };
    }
    addMessage(data);
};

function addMessage({name, avatar, message}) {
    const div = document.createElement("div");
    div.classList.add("donate-item", "bg-white", "text-dark");

    div.innerHTML = `
        <img src="${avatar || "https://via.placeholder.com/50"}" class="avatar">
        <div>
            <strong>${name}</strong><br>
            <span>${message}</span>
        </div>
    `;

    msgList.prepend(div); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏™‡∏∏‡∏î

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏Å‡πÄ‡∏™‡∏µ‡∏¢‡∏á
    const utter = new SpeechSynthesisUtterance(message);
    utter.lang = "th-TH";

    const voices = speechSynthesis.getVoices();
    const maleVoice = voices.find(v => v.lang === "th-TH" && v.name.toLowerCase().includes("male"));
    if(maleVoice) utter.voice = maleVoice;

    speechSynthesis.cancel();
    speechSynthesis.speak(utter);
}

window.speechSynthesis.onvoiceschanged = () => console.log("Voices updated");
</script>

</body>
</html>
